type Deposit @entity(immutable: true) {
  id: Bytes!
  fundId: BigInt! # uint256
  investor: Bytes! # address
  token: Bytes! # address
  symbol: String!
  amount: BigDecimal! # formatted amount (not raw)
  investorShare: BigInt! # uint256
  fundShare: BigInt! # uint256
  fundAmount: BigDecimal! # formatted fund amount (not raw)
  feeAmount: BigDecimal! # formatted fee amount (not raw)
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Swap @entity(immutable: true) {
  id: Bytes!
  fundId: BigInt! # uint256
  investor: Bytes! # address
  tokenIn: Bytes! # address
  tokenOut: Bytes! # address
  tokenInSymbol: String!
  tokenOutSymbol: String!
  tokenInAmount: BigDecimal! # formatted amount (not raw)
  tokenOutAmount: BigDecimal! # formatted amount (not raw)
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Withdraw @entity(immutable: true) {
  id: Bytes!
  fundId: BigInt! # uint256
  investor: Bytes! # address
  percentage: BigDecimal! # withdrawal percentage
  amountUSD: BigDecimal! # USD value of the withdrawal
  tokens: [Bytes!]! # withdrawn token addresses
  tokensSymbols: [String!]! # token symbols
  tokensDecimals: [BigInt!]! # token decimals
  tokensAmount: [BigDecimal!]! # withdrawn amounts per token (formatted)
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type WithdrawFee @entity(immutable: true) {
  id: Bytes!
  fundId: BigInt! # uint256
  manager: Bytes! # address
  token: Bytes! # address
  symbol: String!
  amount: BigDecimal! # formatted amount (not raw)
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Create @entity(immutable: true) {
  id: Bytes!
  fundId: BigInt! # uint256
  manager: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type InfoCreated @entity(immutable: true) {
  id: Bytes!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type OwnerChanged @entity(immutable: true) {
  id: Bytes!
  oldOwner: Bytes! # address
  newOwner: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type Join @entity(immutable: true) {
  id: Bytes!
  fundId: BigInt! # uint256
  investor: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type FundShare @entity(immutable: false) {
  id: String! # fundId
  fundId: BigInt! # uint256
  totalShare: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type InvestorShare @entity(immutable: false) {
  id: String! # fundId-investor
  fundId: BigInt! # uint256
  investor: Bytes! # address
  share: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type SettingCreated @entity(immutable: true) {
  id: Bytes!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type AddToken @entity(immutable: true) {
  id: Bytes!
  token: Bytes! # address
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

# Cache entities for performance optimization
type TokenCache @entity(immutable: false) {
  id: Bytes! # tokenAddress
  tokenAddress: Bytes!
  symbol: String!
  decimals: BigInt!
  updatedTimestamp: BigInt!
}

type PriceCache @entity(immutable: false) {
  id: String! # tokenAddress-timestamp
  tokenAddress: Bytes!
  priceETH: BigDecimal!
  blockNumber: BigInt!
  timestamp: BigInt!
}

type Bundle @entity(immutable: false) {
  id: String! # always "1"
  ethPriceUSD: BigDecimal!
  lastUpdateBlock: BigInt!
  lastUpdateTimestamp: BigInt!
}

type PoolInfo @entity(immutable: false) {
  id: String! # tokenA-tokenB-fee
  tokenA: Bytes!
  tokenB: Bytes!
  fee: Int!
  poolAddress: Bytes!
  token0: Bytes!
  token1: Bytes!
  liquidity: BigInt!
  liquidityUpdatedTimestamp: BigInt!
  sqrtPriceX96: BigInt!
  slot0UpdatedTimestamp: BigInt!
}

# Fund management entities
type Info @entity(immutable: false) {
  id: Bytes!
  fundCount: BigInt!
  investorCount: BigInt!
  totalAmountUSD: BigDecimal!
  owner: Bytes!
}

type Fund @entity(immutable: false) {
  id: String! # fundId
  fundId: String!
  createdAtTimestamp: BigInt!
  updatedAtTimestamp: BigInt!
  manager: Bytes!
  investorCount: BigInt!
  share: BigInt!
  principal: BigDecimal! # Total invested principal in USD (cumulative deposits)
  amountUSD: BigDecimal!
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
  feeTokens: [Bytes!]!
  feeSymbols: [String!]!
  feeTokensAmount: [BigDecimal!]!
  tokens: [Bytes!]!
  tokensSymbols: [String!]!
  tokensDecimals: [BigInt!]!
  tokensAmount: [BigDecimal!]!
}

type Investor @entity(immutable: false) {
  id: String! # fundId-investor
  createdAtTimestamp: BigInt!
  updatedAtTimestamp: BigInt!
  fundId: String!
  investor: Bytes!
  isManager: Boolean!
  share: BigInt
  principal: BigDecimal! # Total invested principal in USD (cumulative deposits)
  amountUSD: BigDecimal! # Current value in USD
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
}

type InvestableToken @entity(immutable: false) {
  id: Bytes! # token address
  address: Bytes!
  decimals: BigInt!
  symbol: String!
  updatedTimestamp: BigInt!
  isInvestable: Boolean!
}

# Snapshot entities for historical tracking
type InfoSnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundCount: BigInt!
  investorCount: BigInt!
  totalAmountUSD: BigDecimal!
}

type InfoWeeklySnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundCount: BigInt!
  investorCount: BigInt!
  totalAmountUSD: BigDecimal!
}

type InfoMonthlySnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundCount: BigInt!
  investorCount: BigInt!
  totalAmountUSD: BigDecimal!
}

type FundSnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundId: String!
  manager: Bytes!
  investorCount: BigInt!
  share: BigInt!
  principal: BigDecimal!
  amountUSD: BigDecimal!
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
  tokens: [Bytes!]!
  tokensSymbols: [String!]!
  tokensDecimals: [BigInt!]!
  tokensAmount: [BigDecimal!]!
  tokensAmountUSD: [BigDecimal!]!
}

type FundWeeklySnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundId: String!
  manager: Bytes!
  investorCount: BigInt!
  share: BigInt!
  principal: BigDecimal!
  amountUSD: BigDecimal!
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
  tokens: [Bytes!]!
  tokensSymbols: [String!]!
  tokensDecimals: [BigInt!]!
  tokensAmount: [BigDecimal!]!
  tokensAmountUSD: [BigDecimal!]!
}

type FundMonthlySnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundId: String!
  manager: Bytes!
  investorCount: BigInt!
  share: BigInt!
  principal: BigDecimal!
  amountUSD: BigDecimal!
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
  tokens: [Bytes!]!
  tokensSymbols: [String!]!
  tokensDecimals: [BigInt!]!
  tokensAmount: [BigDecimal!]!
  tokensAmountUSD: [BigDecimal!]!
}

type InvestorSnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundId: String!
  manager: Bytes!
  investor: Bytes!
  share: BigInt!
  principal: BigDecimal!
  amountUSD: BigDecimal!
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
}

type InvestorWeeklySnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundId: String!
  manager: Bytes!
  investor: Bytes!
  share: BigInt!
  principal: BigDecimal!
  amountUSD: BigDecimal!
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
}

type InvestorMonthlySnapshot @entity(immutable: false) {
  id: ID!
  timestamp: BigInt!
  fundId: String!
  manager: Bytes!
  investor: Bytes!
  share: BigInt!
  principal: BigDecimal!
  amountUSD: BigDecimal!
  profitUSD: BigDecimal!
  profitRatio: BigDecimal!
}

# Manager NFT Entities

type ManagerNFT @entity(immutable: false) {
  id: ID! # tokenId
  tokenId: BigInt! # uint256
  fundId: BigInt! # uint256
  manager: Bytes! # address
  owner: Bytes! # current owner
  investment: BigInt! # initial investment
  currentTVL: BigInt! # current total value locked
  returnRate: BigInt! # return rate
  fundCreated: BigInt! # fund creation timestamp
  mintedAt: BigInt! # minting timestamp
  transactionHash: Bytes! # transaction hash
}